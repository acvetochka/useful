# Захист програмного забезпечення

Це вступ до кібербезпеки від CS50.

Цього тижня розглянемо захист програмного забезпечення, яке ви використовуєте, або ПЗ, яке ви створюєте.

Минулої лекції ви дізналися про різні атаки, які можуть бути використані зловмисниками для отримання інформації від вас.

## Фішинг
Ви дізналися про таку атаку як фішинг, коли зловмисник обманом змушує вас надати певну інформацію.

У вихідному коді сайту, наприклад, мовою HTML, ви можете побачити такий код:
  
```html
    <p>...</p>
```
    
Зауважте, що у наведеному коді абзац починається і закінчується. Він починається стартовим тегом і завершується, відповідно, завершальним тегом.

Так само у посиланнях на вебсторінки використовують певний тип тегів, який називають тегами якоря, щоби перенаправляти користувачів з однієї вебсторінки на іншу.

Такий код виглядає так:
```html
    <a href="https://harvard.edu">Harvard</a>
```
Зверніть увагу, що цей код є тегом-якорем, який дозволяє користувачеві натиснути на слово «Harvard» і перейти на harvard.edu.

На справжній вебсторінці ви зможете навести курсор миші на таке посилання і побачити, куди воно вас спрямує.

Зловмисники можуть спробувати скористатися вашою неуважністю та запевняти, що ви переходите на одну вебсторінку, тоді як насправді ви переходите на іншу. Наприклад, зловмисник може використати такий код:

```html
<a href="https://yale.edu">https://harvard.edu</a>
```
Зауважте, що цей код є тегом якоря: коли користувач натискає на https://harvard.edu, він насправді переходить на yale.edu. Відповідно, користувач думатиме, що він натискає на посилання Гарварда, а перейде на сайт Єльського університету.

Уявіть, як саме ця схема може бути використана зловмисниками, щоб змусити вас думати, що ви відкриєте один вебсайт, тоді як насправді перейдете на інший.

Зловмисники часто створюють фейкові версії сторінок з єдиною метою - змусити користувачів вводити на них конфіденційну інформацію. 

Наприклад, якщо ви були студентом Гарварду і відвідали такий фейковий вебсайт, ви можете спробувати увійти і як результат надати зловмисникам свої ім'я користувача та пароль.

## Ін’єкція коду
Міжсайтове скриптування (XSS) — це тип атаки, під час якого зловмисник змушує вебсайт виконувати шкідливий код, коли користувач вводить дані.

Наприклад, в Google, коли ви шукаєте слово «кіт», зверніть увагу, як воно виглядатиме на екрані в іншому місці, а саме скільки є результатів за цим запитом. Уявіть, що зловмисник, який хоч трохи обізнаний щодо інтернету, може вставити код як вхідні дані, та обдурити вебсайт, тобто змусити його виконати такий код.

Приміром, розгляньмо такий код (його можна вставити в пошуковий рядок):
```html
<script>alert('attack')/<script>
```

Зауважте, як саме цей скрипт відображає повідомлення з написом «атака». Хоча вебсайт Google не виводить таке повідомлення з міркувань безпеки, це наочно демонструє те, що може спробувати зробити зловмисник.

Якщо вебсайт сліпо копіює введені користувачем дані й виводить те, що ввів зловмисник, це і є серйозною загрозою безпеці.

## Відображені атаки
Відображена атака — це атака, яка використовує те, як вебсайти приймають вхідні дані, щоби змусити браузер користувача надіслати запит на інформацію, яка спричинить атаку.

Скажімо, користувача можна змусити натиснути на посилання, структуроване таким чином:
```html
<a href="https://www.google.com/search?q=%3Cscript%3Ealert%28%27attack%27%29%3C%2Fscript%3E">cats</a>
```
Зауважте, що це посилання використовує описаний вище сценарій: якщо користувач натисне на нього, побачить сповіщення про атаку на своєму екрані.

Користувач наче обманює власний веббраузер та змушує його відображати сповіщення про атаку.

## Збережені атаки
Вебсайт може бути вразливим до атаки, під час якої його змушують зберігати шкідливий код.

Насправді надіслати шкідливий код можна й електронною поштою. Якщо поштовий провайдер сліпо приймає будь-який надісланий йому код, будь-яка людина, яка отримає шкідливий код, може стати жертвою атаки.

## Екранування символів
Сервіси використовують екранування символів як метод захисту від таких атак. Програмне забезпечення повинно екранувати потенційно небезпечні символи, які виглядають як загальновідомі в програмуванні.

Наприклад, код, подібний до наведеного
```html
<p>About 6,420,000,000 <script>alert('attack')</script></p>
```
буде виведено захищеним ПЗ як

```html
<p>About 6,420,000,000 &lt;script&gt;alert('attack')&lt;/script&gt;</p>
```
Виглядає складнувато, однак зауважте, що &lt; використовують, щоби приховати символи, потенційно небезпечні для програмного забезпечення. Завдяки цьому шкідливий код перетворюється на рядок тексту.

Найчастіше екранують такі символи:
- `<`, тобто знак менше, «<»
- `>`, тобто знак більше, «>»
- `&`, тобто амперсанд, «&»
- `"`, тобто подвійні лапки, «"»
- `'`, тобто одинарні лапки або апостроф

## Заголовки HTTP
Як ви вже знаєте, заголовки HTTP є додатковими вказівками для браузера.

Розгляньмо такий заголовок:
```shell
Content-Security-Policy: script-src https://example.com/
```
Зауважте, що наведена вище політика безпеки в заголовку вебсайту дозволить завантажувати Javascript тільки окремими файлами, які зазвичай закінчуються на .js. Відповідно, коли діє ця політика безпеки, браузер не буде виконувати теги <script> в заголовку HTML.

Так само наведений нижче заголовок дозволить використання CSS тільки з файлів .css:
```shell
Content-Security-Policy: style-src https://example.com/
```
Зауважте, що style-src вказує на те, що буде дозволено лише CSS, завантажений з файлу .css.

## SQL Iн’єкції
Структурована мова запитів (SQL) — це мова програмування, яка дозволяє отримувати певну інформацію з бази даних.

Розглянемо, як зловмисник може спробувати обдурити SQL для виконання шкідливого коду.

Розглянемо такий SQL-код:
```sql
SELECT * FROM users 
WHERE username = '{username}'
```
Зауважте, що тут введене користувачем ім'я користувача вставляється в код SQL.

Ніколи не довіряйте даним, які вводять користувачі.

Всі дані, які вводяться користувачем, необхідно екранувати (тобто очистити).

Припустімо, зловмисник вставив такий код в рядок для імені користувача:
```sql
malan ';DELETE FROM users; --
```
Зауважте, що окрім імені користувача введено шкідливий код.

Як результат на екрані ви побачите таке:
```sql
SELECT * FROM users 
WHERE username = 'malan'; DELETE FROM users; --'
```
Зауважте, що цим рядком зловмисник наче дописує до запиту код. Як результат, всі користувачі видаляються з системи (тобто з системи користувача видаляється кожен обліковий запис).

Припустімо, що у користувача запитують його ім'я та пароль таким чином:
```sql
SELECT * FROM users 
WHERE username = '{username}' AND password = '{password}'
```
Зауважте, що у користувача запитують його ім'я та пароль.

Зловмисник може вставити у поле замість пароля таке:
```
' OR '1'='1
```
Після цього запуститься такий SQL-код:
```sql
SELECT * FROM users 
WHERE username = 'malan' AND password = "
OR '1'='1'
```
Зверніть увагу, що граматично це призводить до надання всіх користувачів у базі даних.

Щоби було трошки зрозуміліше, зверніть увагу на додаткові дужки як показано нижче:
```sql
SELECT * FROM users 
WHERE (username = 'malan' AND password = '') 
OR '1'='1'
```
Зауважте, що завдяки цьому коду зловмисник побачить або всіх користувачів, для яких комбінація імені користувача та пароля є істинною АБО всіх користувачів.

Фактично, наведене вище введення завжди є істинним. Завдяки цій прогалині в безпеці зловмисник зможе отримати інформацію про всіх користувачів системи, зокрема й дані адміністратора.

## Підготовлені запити
Підготовлені запити — це заздалегідь створені фрагменти коду, які коректно обробляють велику кількість функцій бази даних, зокрема дані, введені користувачем.

Такі запити, зокрема, гарантують, що введені користувачем дані правильно екрануються.

Підготовлений запит приймає код у такому вигляді
```sql
SELECT * FROM users 
WHERE username = '{username}'
```
і замінює його таким…

```sql
SELECT * FROM users 
WHERE username = ?
```
Підготовлені запити шукатимуть будь-які символи ' і замінюватимуть їх на ' ' '.

Отже, наша попередня атака, показана вище, буде відбита підготовленим запитом таким чином:

```sql
SELECT * FROM users 
WHERE username = 'malan'; DELETE FROM users; --'
```
Зауважте, що останній символ ' у слові 'malan' замінено на ' ', через що шкідливий код не спрацює.

Як результат, шкідливі символи екрануються, через що шкідливий код не запускається.

## Ін’єкція командного рядка
Інтерфейс командного рядка дозволяє керувати операційною системою комп’ютера за допомогою текстових команд, без натискання на меню та кнопки.

Командна ін’єкція — це атака, яка запускає команду в системі комп’ютера.

Якщо користувач введе команду в інтерфейс командного рядка, наслідки можуть бути катастрофічними.

Найпоширеніші слабкі місця — це system та eval, які можуть виконати команди зловмисника у вашій системі, якщо ви передаєте дані, введені користувачем, без попереднього очищення.

Завжди читайте документацію, щоби знати як знешкоджувати дані, які вводять користувачі.

## Інструменти розробника
Повернімося до світу HTML та інтернету.

У контексті браузера, інструменти розробника дозволяють вам досліджувати базовий код вебсторінки.

Розгляньмо, що можна зробити за допомогою інструментів розробника. Ось код текстового поля:
```html
<input disabled type="checkbox">
```
Зауважте, у результаті буде створено тип даних, який називається чекбокс. Крім того, зверніть увагу, що це текстове поле вимкнено за допомогою атрибуту disabled і не може бути використане.

Можливо, основна небезпека HTML у тому, що HTML зберігається на комп'ютері користувача. Отже, користувач може змінювати локальний файл на своєму комп'ютері.

Користувач, який має доступ до HTML на власному комп'ютері за допомогою інструментів розробника, може змінювати HTML.
```html
<input type="checkbox">
```
Зауважте, що в локальній копії HTML вилучено атрибут disabled.

Ніколи не покладайтеся на перевірку лише на стороні клієнта.

Так само розгляньмо наступний HTML:
```html
<input required type="text">
```
Зверніть увагу на вимогу ввести цей текст (required).

Хтось, хто має доступ до інструментів розробника, може вилучити вимогу щодо цього введення ось так:
```html
<input type="text">
```
Зауважте, що вимогу (атрибут required) вилучено.

Знову ж таки, якщо йдеться про безпеку вашого вебзастосунка, ніколи не довіряйте перевірці лише на стороні клієнта.

## Перевірка на стороні сервера
Перевірка на стороні сервера містить функції безпеки, завдяки яким дані, введені користувачами, завжди підходять та безпечні.

Хоча це питання за межами цієї лекції, запам’ятайте правило: дані, введені користувачем, повинні перевірятися на стороні сервера. Не варто безумовно довіряти даним користувачів.

## Міжсайтова підробка запитів (CSRF)
Інша загроза називається міжсайтовою підробкою запитів або CSRF.

Вебсайти зазвичай взаємодіють з користувачами через методи, які називаються GET і POST.

GET отримує інформацію з сервера.

Погляньте як Amazon використовує функцію GET у наведеному HTML-коді:
```html
<a href="https://www.amazon.com/dp/B07XLQ2FSK">Buy Now</a>
```
Зауважте як можна купити цей продукт в один клік.

Так само можна обманом змусити когось купити те, що він не збирався купувати.

Можна створити зображення для автоматичної купівлі цього товару
```html
<img src="https://www.amazon.com/dp/B07XLQ2FSK">
```
Зауважте, що насправді тут немає жодного зображення. Замість цього браузер пробує виконати метод GET на вебсторінці, щоби, можливо, здійснити заборонену або небажану покупку.

Так само зловмисники можуть використовувати метод POST для здійснення небажаних покупок.

Розгляньмо наведений HTML-код кнопки «Купити зараз»:
```html
<form action="https://www.amazon.com/" method="post">
    <input name="dp" type="hidden" value="B07XLQ2FSK">
    <button type="submit">Buy Now</button>
</form>
```
Подивіться як вебформа, реалізована вище, може легко змусити людину повірити, що вона захищена від здійснення небажаної покупки. Оскільки ця форма містить приховане значення, яке гіпотетично використовується Amazon для перевірки, розробник також може думати, що користувачі в безпеці.

Однак, як і з більшістю експлоїтів, таке відчуття безпеки помилкове.

Фактично, додавання лише кількох рядків коду може зашкодити усьому вищезазначеному. Уявіть, що зловмисник розмістив наведений нижче код на своєму власному сайті (не на сайті Amazon):
```html
<form action="https://www.amazon.com/" method="post">
<input name="dp" type="hidden" value="B07XLQ2FSK">
<button type="submit">Buy Now</button>
</form>
<script>
document.forms[0].submit();
</script>
```
Подивіться, як кілька рядків коду на сайті зловмисника можуть знайти форму і надіслати її автоматично.

Така вірогідність обманом змусити користувача виконати команди на іншому вебсайті і є суттю CSRF.

Одним зі способів захисту від подібних атак є токен CSRF, завдяки якому сервер генерує секретне значення для кожного користувача. Таким чином, сервер перевіряє, чи відповідає токен CSRF, наданий користувачем, токену, передбаченому сервером.

Ці токени зазвичай додаються в HTML-заголовки.

## Виконання довільного коду (ACE)
Виконання довільного коду (англ. Arbitrary code execution - ACE) — це виконання коду, який не є компонентом програмного забезпечення.

Однією із кіберзагроз є переповнення буфера, коли програма перевантажена вхідними даними. Такі дані переповнюють інші ділянки пам'яті, що призводить до некоректної роботи програми. Наприклад, програма може очікувати на ввід короткого рядка з даних, а користувач надає довгий рядок з даними.

Інша подібна загроза називається переповненням стека, коли цей стек можна використати для вставки та виконання шкідливого коду.

Іноді подібні атаки можуть бути використані для зламу або обходу реєстрації чи сплати за програмне забезпечення.

Крім того, подібні атаки можуть бути використані для зворотної інженерії, щоби побачити, як працює код.

## ПЗ з відкритим кодом
Щоби уникнути подібних загроз, можна використовувати програмне забезпечення з відкритим вихідним кодом. Код такого програмного забезпечення знаходиться у вільному доступі в інтернеті і його може побачити будь-хто.

Можна здійснити аудит коду та переконатися, що він краще захищений від кібератак.

Однак таке ПЗ все одно ще вразливе до атак.

## ПЗ із закритим кодом
Програмне забезпечення із закритим кодом — це протилежність програмного забезпечення з відкритим кодом.

Код такого програмного забезпечення недоступний широкому загалу, а отже, він менш вразливий для хакерських атак.

Однак існує певний компроміс між програмним забезпеченням з відкритим кодом, де тисячі очей можуть шукати вразливості в програмному забезпеченні, і закритим, де код прихований від загалу.

## Магазини застосунків
Магазинами застосунків керують такі компанії, як Google та Apple. Вони перевіряють, чи завантажений код не є небезпечним.

Коли ви встановлюєте лише авторизоване програмне забезпечення, ви набагато захищеніші, ніж коли встановлюєте програмне забезпечення від стороннього розробника не з магазину застосунків.

Магазини застосунків використовують шифрування, щоб приймати лише програмне забезпечення або код від авторизованих розробників. Своєю чергою, магазини застосунків підписують програмне забезпечення цифровим підписом. Таким чином, операційні системи розуміють, що встановлюється лише дозволене, підписане програмне забезпечення.

## Менеджери пакетів
Менеджери пакетів використовують подібний механізм підписання, щоби впевнитися, що можна довіряти тому, що ви завантажуєте від третіх осіб. Однак не можна бути абсолютно впевненими у безпеці таких завантажень.

Відповідно, необхідно завжди намагатися ускладнити завдання для зловмисників, які намагатимуться встановити шкідливий код.

## Винагороди за виправлення помилок
Винагороди за виправлення помилок — це можливості трохи заробити для людей, які знаходитимуть вразливості в програмному забезпеченні та повідомлятимуть про них.

Такі винагороди можуть позитивно вплинути на потенційних зловмисників, тобто переконати їх отримати винагороди за пошук вразливостей замість того, щоби використовувати їх для зламу ПЗ.

## Пошук вразливостей
Як розробники, ви можете ознайомитися з базою даних загальних вразливостей та виявлення або кодами CVE, щоб розуміти, чим саме займаються зловмисники по всьому світу.

Крім того, ви можете взяти до уваги загальну систему оцінки вразливостей (CVSS), щоби розуміти, наскільки серйозними є такі загрози.

Існує також система підрахунку балів для прогнозування ризиків експлойтів (EPSS), яка дозволяє розробникам розуміти потенціал вразливостей по всьому світу та визначати пріоритети своїх безпекових зусиль.

Каталог відомих експлуатованих вразливостей (KEV) — це список відомих вразливостей.
