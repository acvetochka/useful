–î–ª—è –±–µ–∑–ø–µ—á–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–æ–≥–æ —é–∑–µ—Ä–∞.
–£—Å—ñ –¥—ñ—ó –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –≤ —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ –Ω–∞ –Ω–æ–≤–æ–º—É Droplet —á–µ—Ä–µ–∑ SSH. –ü–æ—è—Å–Ω–µ–Ω–Ω—è –ø—ñ–¥ –∫–æ–∂–Ω–æ—é –∫–æ–º–∞–Ω–¥–æ—é ‚Äî —â–æ –≤–æ–Ω–∞ —Ä–æ–±–∏—Ç—å —ñ –Ω–∞ —â–æ –∑–≤–µ—Ä–Ω—É—Ç–∏ —É–≤–∞–≥—É.

–í–ê–ñ–õ–ò–í–û –ü–ï–†–ï–î –ü–û–ß–ê–¢–ö–û–ú:
–ù–µ –∑–∞–∫—Ä–∏–≤–∞–π –ø–æ—Ç–æ—á–Ω—É SSH-—Å–µ—Å—ñ—é! –ü—ñ—Å–ª—è –≤–Ω–µ—Å–µ–Ω–Ω—è –∑–º—ñ–Ω —Ç–∏ –≤—ñ–¥–∫—Ä–∏—î—à –Ω–æ–≤–µ –∑'—î–¥–Ω–∞–Ω–Ω—è –ø—ñ–¥ –Ω–æ–≤–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º, –ø–µ—Ä–µ–≤—ñ—Ä–∏—à, —â–æ –≤—Å–µ –ø—Ä–∞—Ü—é—î, —ñ —Ç—ñ–ª—å–∫–∏ –ø–æ—Ç—ñ–º –∑–∞–∫—Ä–∏—î—à —Å—Ç–∞—Ä–µ. –¶–µ —É–±–µ—Ä–µ–∂e –≤—ñ–¥ ¬´–≤—ñ–¥—Å—ñ–∫–∞–Ω–Ω—è¬ª —Å–µ–±–µ –≤—ñ–¥ —Å–µ—Ä–≤–µ—Ä–∞.

# 0) –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞: –∑–∞–ª–∏—à–∞–π –ø–æ—Ç–æ—á–Ω—É —Å–µ—Å—ñ—é –≤—ñ–¥–∫—Ä–∏—Ç–æ—é

–í—ñ–¥–∫—Ä–∏–π —â–µ –æ–¥–∏–Ω —Ç–µ—Ä–º—ñ–Ω–∞–ª (–∞–±–æ –≤–∫–ª–∞–¥–∫—É) –Ω–∞ —Ç–≤–æ—î–º—É –∫–æ–º–ø‚Äô—é—Ç–µ—Ä—ñ ‚Äî –±—É–¥–µ–º–æ –≤ –Ω—å–æ–º—É —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –≤—Ö—ñ–¥ –ø—ñ–¥ –Ω–æ–≤–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º. –Ø–∫—â–æ —â–æ—Å—å –ø—ñ–¥–µ –Ω–µ —Ç–∞–∫, —É —Ç–µ–±–µ –∑–∞–ª–∏—à–∏—Ç—å—Å—è —Ä–æ–±–æ—á–∞ —Å–µ—Å—ñ—è.

# 1) –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ newuser) —ñ –¥–∞—Ç–∏ –π–æ–º—É –ø—Ä–∞–≤–∞ sudo

–°—Ç–≤–æ—Ä–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:

```bash
sudo adduser newuser
```

–¢–µ–±–µ –ø–æ–ø—Ä–æ—Å—è—Ç—å –≤–≤–µ—Å—Ç–∏ –ø–∞—Ä–æ–ª—å –¥–ª—è newuser ‚Äî –º–æ–∂–Ω–∞ –≤–≤–µ—Å—Ç–∏, –∞–ª–µ –º–∏ –ø–æ—Ç—ñ–º –∑–∞–±–æ—Ä–æ–Ω–∏–º–æ –ª–æ–≥—ñ–Ω –ø–æ –ø–∞—Ä–æ–ª—é, —Ç–æ–º—É –ø–∞—Ä–æ–ª—å –Ω–µ –≤–∞–∂–ª–∏–≤–∏–π. –ó–∞–ø–æ–≤–Ω—é–≤–∞—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–æ–ª—è (Full Name —Ç–æ—â–æ) –Ω–µ –æ–±–æ–≤ º—è–∑–∫–æ–≤–æ ‚Äî –Ω–∞—Ç–∏—Å–∫–∞–π Enter.

–î–æ–¥–∞—Ç–∏ –≤ –≥—Ä—É–ø—É sudo:

```bash
sudo usermod -aG sudo newuser
```

–¢–µ–ø–µ—Ä newuser –º–æ–∂–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∫–æ–º–∞–Ω–¥–∏ –∑ sudo.

# 2. –î–æ–¥–∞—Ç–∏ —Ç–≤—ñ–π –ø—É–±–ª—ñ—á–Ω–∏–π SSH-–∫–ª—é—á –≤ –∞–∫–∞—É–Ω—Ç newuser

–ù–∞ –°–í–û–Ñ–ú–£ –∫–æ–º–ø‚Äô—é—Ç–µ—Ä—ñ –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ SSH-–∫–ª—é—á –¥–ª—è deployuser
–ù–∞ –≤–∞—à—ñ–π Windows / Linux / Mac (–ª–æ–∫–∞–ª—å–Ω–∏–π –ü–ö):

```bash
ssh-keygen -t ed25519 -C "deployuser@server"
```

–ü—ñ—Å–ª—è —Ü—å–æ–≥–æ –∑'—è–≤–ª—è—Ç—å—Å—è —Ñ–∞–π–ª–∏:

- –ø—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á ‚Üí `~/.ssh/id_ed25519`
- –ø—É–±–ª—ñ—á–Ω–∏–π ‚Üí `~/.ssh/id_ed25519.pub`

‚ö†Ô∏è –ü–†–ò–í–ê–¢–ù–ò–ô –∫–ª—é—á –Ω—ñ–∫–æ–º—É –Ω–µ –¥–∞–≤–∞—Ç–∏!

–í—ñ–¥–∫—Ä–∏–π —Ñ–∞–π–ª –ø—É–±–ª—ñ—á–Ω–æ–≥–æ –∫–ª—é—á–∞ —ñ —Å–∫–æ–ø—ñ—é–π –π–æ–≥–æ –≤ –±—É—Ñ–µ—Ä.

–£ —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ –ø—ñ–¥ root (–∞–±–æ –≤ —Ç—ñ–π —Å–µ—Å—ñ—ó, –¥–µ —Ç–∏ –∑–∞—Ä–∞–∑):
–°—Ç–≤–æ—Ä–∏ .ssh –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–∏ –ø—Ä–∞–≤–∞:

```bash
sudo mkdir -p /home/newuser/.ssh
sudo chmod 700 /home/newuser/.ssh
sudo chown newuser:newuser /home/newuser/.ssh
```

–í—Å—Ç–∞–≤ –ø—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á —É authorized_keys:

```bash
sudo nano /home/newuser/.ssh/authorized_keys
```

‚Äî —É nano –≤—Å—Ç–∞–≤ (Paste) –≤–º—ñ—Å—Ç —Å–≤–æ–≥–æ `id_rsa.pub` –∞–±–æ `id_ed25519.pub`. –ü–æ—Ç—ñ–º `Ctrl+O` (–∑–±–µ—Ä–µ–≥—Ç–∏), Enter, `Ctrl+X` (–≤–∏–π—Ç–∏).

–í—Å—Ç–∞–Ω–æ–≤–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –ø—Ä–∞–≤–∞ —Ñ–∞–π–ª—É:

```bash
sudo chmod 600 /home/newuser/.ssh/authorized_keys
sudo chown newuser:newuser /home/newuser/.ssh/authorized_keys
```

# 3. –¢–µ–ø–µ—Ä –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—Ö–æ–¥—É –ø—ñ–¥ –Ω–æ–≤–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º (–≤ —ñ–Ω—à–æ–º—É —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ –Ω–∞ —Ç–≤–æ—î–º—É –∫–æ–º–ø‚Äô—é—Ç–µ—Ä—ñ)

–ù–µ –∑–∞–∫—Ä–∏–≤–∞–π —Å—Ç–∞—Ä—É —Å–µ—Å—ñ—é. –£ –Ω–æ–≤—ñ–π —Å–ø—Ä–æ–±—É–π –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å:

```bash
ssh newuser@YOUR_SERVER_IP
```

–Ø–∫—â–æ –≤—Ö—ñ–¥ —É—Å–ø—ñ—à–Ω–∏–π ‚Äî –≤—Å–µ –¥–æ–±—Ä–µ. –Ø–∫—â–æ –Ω–µ –≤–¥–∞—î—Ç—å—Å—è, –Ω–µ —Ä–æ–±–∏ –∂–æ–¥–Ω–∏—Ö –∑–º—ñ–Ω, –ø–æ–∫–∏ –Ω–µ –≤–∏—è—Å–Ω–∏—à –ø—Ä–∏—á–∏–Ω—É (–ø–æ–≤–µ—Ä–Ω–∏—Å—å —É —Å—Ç–∞—Ä—É —Å–µ—Å—ñ—é).

# 4. –ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ –ª–æ–≥—ñ–Ω –ø–æ –ø–∞—Ä–æ–ª—é —ñ root-–ª–æ–≥—ñ–Ω –ø–æ –ø–∞—Ä–æ–ª—é

–ö–æ–ª–∏ –≤—Ö—ñ–¥ –ø—ñ–¥ newuser –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ, –ø–æ–≤–µ—Ä–Ω–∏—Å—å —É —Å—Ç–∞—Ä—É (–∞–±–æ –±—É–¥—å-—è–∫—É —Ä–æ–±–æ—á—É) —Å–µ—Å—ñ—é —ñ –∑—Ä–æ–±–∏ –∑–º—ñ–Ω–∏ –≤ SSH-–∫–æ–Ω—Ñ—ñ–≥:

–†–µ–¥–∞–≥—É–π –∫–æ–Ω—Ñ—ñ–≥:

```bash
sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.bak
sudo nano /etc/ssh/sshd_config
```

–ó–Ω–∞–π–¥–∏ (–∞–±–æ –¥–æ–¥–∞–π / –∑–º—ñ–Ω—ñ) —Ü—ñ —Ä—è–¥–∫–∏ —Ç–∞–∫, —â–æ–± –≤–æ–Ω–∏ –≤–∏–≥–ª—è–¥–∞–ª–∏ —Ç–æ—á–Ω–æ —Ç–∞–∫:

```
PermitRootLogin no
PasswordAuthentication no
ChallengeResponseAuthentication no
UsePAM yes
```

- `PermitRootLogin no` ‚Äî –ø–æ–≤–Ω—ñ—Å—Ç—é –∑–∞–±–æ—Ä–æ–Ω—è—î –ª–æ–≥—ñ–Ω root (—á–µ—Ä–µ–∑ –ø–∞—Ä–æ–ª—å –∞–±–æ –∫–ª—é—á). –Ø–∫—â–æ —Ç–∏ —Ö–æ—á–µ—à –¥–æ–∑–≤–æ–ª–∏—Ç–∏ root –ø–æ –∫–ª—é—á—É –ª–∏—à–µ —Ç–∏–º—á–∞—Å–æ–≤–æ ‚Äî –º–æ–∂–µ—à –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ prohibit-password, –∞–ª–µ –∫—Ä–∞—â–µ no.

- `PasswordAuthentication no` ‚Äî –∑–∞–±–æ—Ä–æ–Ω—è—î –ª–æ–≥—ñ–Ω –ø–æ –ø–∞—Ä–æ–ª—é –¥–ª—è –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (–∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –ª–∏—à–µ –ø–æ –∫–ª—é—á—É).

- `ChallengeResponseAuthentication no` ‚Äî –¥–æ–¥–∞—Ç–∫–æ–≤–∞ –æ–ø—Ü—ñ—è.

- `UsePAM yes` ‚Äî –∑–≤–∏—á–∞–π–Ω–æ –º–∞—î –±—É—Ç–∏, –∞–ª–µ –Ω–µ –º—ñ–Ω—è–π, —è–∫—â–æ –±—É–ª–æ —ñ–Ω—à–µ.

–ü–µ—Ä–µ–¥ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º sshd –ø–µ—Ä–µ–≤—ñ—Ä –∫–æ–Ω—Ñ—ñ–≥ –Ω–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å:

```bash
sudo sshd -t
```

–Ø–∫—â–æ –∫–æ–º–∞–Ω–¥–∞ –Ω—ñ—á–æ–≥–æ –Ω–µ –≤–∏–≤–µ–ª–∞ ‚Äî —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –û–ö. –Ø–∫—â–æ —î –ø–æ–º–∏–ª–∫–∞ ‚Äî –≤–∏–ø—Ä–∞–≤ —ó—ó —É —Ñ–∞–π–ª—ñ.

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ sshd (–Ω–µ –∑–∞–∫—Ä–∏–≤–∞—é—á–∏ —Å–µ—Å—ñ—é):

```bash
sudo systemctl reload sshd
```

–ê–±–æ, —è–∫—â–æ reload –Ω–µ –ø—Ä–∞—Ü—é—î:

```bash
sudo systemctl restart sshd
```

–¢–ï–°–¢: –∑ —ñ–Ω—à–æ–≥–æ —Ç–µ—Ä–º—ñ–Ω–∞–ª—É (–¥–µ —Ç–∏ –ø—Ä–æ–±—É–≤–∞–≤ –≤—Ö—ñ–¥ –ø—ñ–¥ newuser) –≤–∏–π–¥–∏ —ñ –∑–∞–π–¥–∏ –∑–Ω–æ–≤—É, –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ –∫–ª—é—á–µ–º –∑–∞—Ö–æ–¥–∏—à. –í—ñ–¥–∫—Ä–∏–π —â–µ –æ–¥–Ω—É –Ω–æ–≤—É —Å–µ—Å—ñ—é –Ω–∞ –≤–∏–ø–∞–¥–æ–∫: —è–∫—â–æ –Ω–æ–≤–∏–π –≤—Ö—ñ–¥ –Ω–µ –ø—Ä–∞—Ü—é—î ‚Äî —É —Ç–µ–±–µ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è —Å—Ç–∞—Ä–∞ —Å–µ—Å—ñ—è.

## 5. (–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ) –ó–∞—Ñ—ñ–∫—Å—É–≤–∞—Ç–∏ SSH-–ø–æ—Ä—Ç –∞–±–æ –¥–æ–∑–≤–æ–ª–∏—Ç–∏ SSH –ª–∏—à–µ –∑ —Ç–≤–æ–≥–æ IP

–Ø–∫—â–æ —É —Ç–µ–±–µ —Å—Ç–∞–±—ñ–ª—å–Ω–∞ –¥–æ–º–∞—à–Ω—è IP-–∞–¥—Ä–µ—Å–∞, –º–æ–∂–Ω–∞ –æ–±–º–µ–∂–∏—Ç–∏ SSH –ª–∏—à–µ –∑ –Ω–µ—ó (—â–µ –±–µ–∑–ø–µ—á–Ω—ñ—à–µ). –î–≤—ñ –æ–ø—Ü—ñ—ó:

### A) –î–æ–∑–≤–æ–ª–∏—Ç–∏ SSH –ª–∏—à–µ –∑ —Ç–≤–æ–≥–æ IP —É UFW (–ø—ñ–∑–Ω—ñ—à–µ –≤—Å—Ç–∞–Ω–æ–≤–∏–º–æ UFW)

–ü—Ä–∏–ø—É—Å—Ç–∏–º–æ —Ç–≤—ñ–π IP = X.X.X.X (–∑–∞–º—ñ–Ω–∏—Ç–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω–∏–π):

```bash
sudo ufw allow from X.X.X.X to any port 22 proto tcp
```

### B) –ó–º—ñ–Ω–∏—Ç–∏ –ø–æ—Ä—Ç SSH (–æ–ø—Ü—ñ–π–Ω–æ)

–í sshd_config –∑–º—ñ–Ω–∏ Port 22 –Ω–∞ —ñ–Ω—à–∏–π (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ Port 2222) ‚Äî –∞–ª–µ —Ç–æ–¥—ñ —Ç—Ä–µ–±–∞ –≤–∫–∞–∑—É–≤–∞—Ç–∏ –ø–æ—Ä—Ç –ø—Ä–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—ñ ssh -p 2222 newuser@IP. –¶–µ –∑–º–µ–Ω—à—É—î —à—É–º –≤—ñ–¥ –±—Ä—É—Ç—Ñ–æ—Ä—Å—É, –∞–ª–µ –Ω–µ –∑–∞–º—ñ–Ω—é—î –∫–ª—é—á—ñ.

## 6. –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ UFW (–±—Ä–∞–Ω–¥–º–∞—É–µ—Ä) ‚Äî –±–∞–∑–æ–≤–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏:

```bash
sudo apt update
sudo apt install ufw -y
```

–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ –õ–û–ö–ê–õ–¨–ù–û (–¥—É–∂–µ –≤–∞–∂–ª–∏–≤–æ –∑—Ä–æ–±–∏—Ç–∏ allow ssh –ø–µ—Ä–µ–¥ —É–≤—ñ–º–∫–Ω–µ–Ω–Ω—è–º, —â–æ–± –Ω–µ –≤—ñ–¥—ñ—Ä–≤–∞—Ç–∏—Å—è):

# –Ø–∫—â–æ –¥–æ–∑–≤–æ–ª—è—î—à SSH –≤—Å—ñ–º:

```bash
sudo ufw allow 22/tcp
```

# –Ø–∫—â–æ —Ç–∏ –∑–º—ñ–Ω–∏–≤ –ø–æ—Ä—Ç –Ω–∞ 2222:

```bash
sudo ufw allow 2222/tcp
```

–î–æ–∑–≤–æ–ª–∏—Ç–∏ HTTP/HTTPS:

```bash
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
```

–£–≤—ñ–º–∫–Ω—É—Ç–∏ UFW:

```bash
sudo ufw enable
```

–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å:

```bash
sudo ufw status verbose
```

–Ø–∫—â–æ —Ö–æ—á–µ—à –¥–æ–∑–≤–æ–ª—è—Ç–∏ SSH –ª–∏—à–µ –∑ —Ç–≤–æ–≥–æ IP:

```bash
sudo ufw allow from X.X.X.X to any port 22 proto tcp
sudo ufw delete allow 22/tcp
```

## 7. –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ Fail2Ban ‚Äî –∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ brute-force

–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏:

```bash
sudo apt install fail2ban -y
```

–°—Ç–≤–æ—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–∏–π –∫–æ–Ω—Ñ—ñ–≥ –¥–ª—è nginx/ssh:

```bash
sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local
sudo nano /etc/fail2ban/jail.local
```

–£ —Ñ–∞–π–ª—ñ –∑–Ω–∞–π–¥–∏ —Å–µ–∫—Ü—ñ—é [sshd] —ñ –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ –≤–æ–Ω–∞ –≤–∫–ª—é—á–µ–Ω–∞:

```
[sshd]
enabled = true
port = ssh
filter = sshd
logpath = /var/log/auth.log
maxretry = 5
```

–î–ª—è nginx –¥–æ–¥–∞–π —Ñ—ñ–ª—å—Ç—Ä–∏

<details>
<summary>–Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –∑ –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ –¥–ª—è nginx</summary>

1Ô∏è‚É£ –°—Ç–≤–æ—Ä—é—î–º–æ —Ñ–∞–π–ª –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –∞–±–æ –≤—Å—Ç–∞–≤–ª—è—î–º–æ —É server { ... }

```config
# ---- Rate limiting zone ----
# –í–∫–∞–∂–∏ —Ç—É—Ç —Å–≤–æ—é –ª–æ–∫–∞–ª—å–Ω—É IP –∞–¥—Ä–µ—Å—É
geo $trusted_ip {
    default 0;
    123.45.67.89 1;  # <-- –∑–∞–º—ñ–Ω–∏ –Ω–∞ —Å–≤–æ—é IP
}

limit_req_zone $binary_remote_addr zone=one:10m rate=6r/s;

server {
    listen 80;
    server_name yourdomain.com www.yourdomain.com;

    root /var/www/yourdomain;

    # ---- Rate limiting ----
    location / {
        # –Ø–∫—â–æ –Ω–µ —Ç–≤–æ—è IP ‚Äî –∑–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ –ª—ñ–º—ñ—Ç
        if ($trusted_ip = 0) {
            limit_req zone=one burst=12 nodelay;
        }
        try_files $uri $uri/ =404;
    }

    # ---- Block suspicious URLs ----
    location ~* /(wp-login\.php|wp-admin|install\.php|xmlrpc\.php|\.env|themes\.php|click\.php|m\.php) {
        deny all;
        return 403;
    }

    # ---- Block suspicious User-Agents ----
    if ($http_user_agent ~* "(?:bot|crawl|spider|scanner|sqlmap|nikto|cypex\.ai)") {
        return 403;
    }

    # ---- Security headers ----
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
    add_header X-XSS-Protection "1; mode=block" always;

    # ---- Logging ----
    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;
}
```

2Ô∏è‚É£ –ü–æ—è—Å–Ω–µ–Ω–Ω—è

`geo $trusted_ip { ... }`

–í–∫–∞–∑—É—î–º–æ —Å–≤–æ—é IP, —è–∫–∞ –Ω–µ –ø–æ—Ç—Ä–∞–ø–ª—è—î –ø—ñ–¥ –æ–±–º–µ–∂–µ–Ω–Ω—è.

`default 0` ‚Äî –≤—Å—ñ —ñ–Ω—à—ñ IP –æ–±–º–µ–∂—É—é—Ç—å—Å—è.

`limit_req_zone $binary_remote_addr zone=one:10m rate=6r/s`

- zone=one:10m ‚Äî –ø–∞–º‚Äô—è—Ç—å –Ω–∞ 10 –ú–ë –¥–ª—è –æ–±–ª—ñ–∫—É IP.
- –ú–∞–∫—Å–∏–º—É–º 6 –∑–∞–ø–∏—Ç—ñ–≤ –Ω–∞ —Å–µ–∫—É–Ω–¥—É –Ω–∞ IP.

`burst=12 nodelay` ‚Äî –∫–æ—Ä–æ—Ç–∫—ñ —Å–ø–ª–µ—Å–∫–∏ –¥–æ 12 –∑–∞–ø–∏—Ç—ñ–≤ –±–ª–æ–∫—É—é—Ç—å—Å—è –≤—ñ–¥—Ä–∞–∑—É, –±–µ–∑ –∑–∞—Ç—Ä–∏–º–∫–∏.

`location ~* /(...)`

–ë–ª–æ–∫—É—î –≤—Å—ñ –∑–∞–ø–∏—Ç–∏ –¥–æ –≤—ñ–¥–æ–º–∏—Ö —Å–∫—Ä–∏–ø—Ç—ñ–≤ WordPress, —É—Å—Ç–∞–Ω–æ–≤—á–∏—Ö —Ñ–∞–π–ª—ñ–≤ —Ç–∞ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ —à–∫—ñ–¥–ª–∏–≤–∏—Ö PHP-—Ñ–∞–π–ª—ñ–≤.

`User-Agent` –±–ª–æ–∫—É–≤–∞–Ω–Ω—è:

–ó–∞–±–æ—Ä–æ–Ω—è—î –≤—ñ–¥–æ–º—ñ –±–æ—Ç–∏, —Å–∫–∞–Ω–µ—Ä–∏ —ñ cypex.ai.

`Security headers`:

–ó–∞—Ö–∏—â–∞—é—Ç—å –≤—ñ–¥ XSS, clickjacking —ñ MIME-sniffing.

3Ô∏è‚É£ –Ø–∫ –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏

–í—Å—Ç–∞–≤ —Ü–µ–π –±–ª–æ–∫ —É —Å–≤—ñ–π —Ñ–∞–π–ª –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó Nginx (/etc/nginx/sites-available/yourdomain.com).

–ü–µ—Ä–µ–≤—ñ—Ä –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é:

```bash
sudo nginx -t
```

–ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂ Nginx:

```bash
sudo systemctl reload nginx
```

üí° –ü–æ—Ä–∞–¥–∞:

–ú–æ–∂–Ω–∞ –¥–æ–¥–∞–≤–∞—Ç–∏ —â–µ IP —É geo $trusted_ip, —è–∫—â–æ –ø—Ä–∞—Ü—é—î—à –∑ –¥–µ–∫—ñ–ª—å–∫–æ—Ö –ª–æ–∫–∞—Ü—ñ–π.

–ü—ñ—Å–ª—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó —É–≤–∞–∂–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä –ª–æ–≥–∏ `access.log` —ñ `error.log`, —â–æ–± –≤–ø–µ–≤–Ω–∏—Ç–∏—Å—è, —â–æ –ª–µ–≥–∞–ª—å–Ω–∏–π —Ç—Ä–∞—Ñ—ñ–∫ –Ω–µ –±–ª–æ–∫—É—î—Ç—å—Å—è.

</details>

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏:

```bash
sudo systemctl enable --now fail2ban
sudo systemctl status fail2ban
```

## 8. –û–Ω–æ–≤–∏—Ç–∏ —Å–∏—Å—Ç–µ–º—É —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –±–∞–∑–æ–≤—ñ –ø–∞–∫–µ—Ç–∏

–û–Ω–æ–≤–ª–µ–Ω–Ω—è:

```bash
sudo apt update
sudo apt upgrade -y
```

–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑–∞–≥–∞–ª—å–Ω—ñ —É—Ç–∏–ª—ñ—Ç–∏:

```bash
sudo apt install git curl unzip -y
```

## 9. (–û–ø—Ü—ñ–π–Ω–æ, –∞–ª–µ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ) –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ vnstat, —â–æ–± –º–æ–Ω—ñ—Ç–æ—Ä–∏—Ç–∏ —Ç—Ä–∞—Ñ—ñ–∫

```bash
   sudo apt install vnstat -y
   sudo systemctl enable --now vnstat
   vnstat -m
```

## 10. –†–µ–∑–µ—Ä–≤–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –±–µ–∑–ø–µ—á–Ω–æ—Å—Ç—ñ

–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ –≤—Ö–æ–¥–∏—à –ø—ñ–¥ newuser –ø–æ –∫–ª—é—á—É (—á–µ—Ä–µ–∑ —ñ–Ω—à–∏–π —Ç–µ—Ä–º—ñ–Ω–∞–ª).

```bash
ssh -i ~/.ssh/id_ed25519 newuser@YOUR_SERVER_IP
```

–ö–æ–ª–∏ –≤—Å–µ –ø—Ä–∞—Ü—é—î —ñ —Ç–∏ –≤–ø–µ–≤–Ω–µ–Ω–∞ ‚Äî –º–æ–∂–Ω–∞ –∑–∞–∫—Ä–∏—Ç–∏ —Å—Ç–∞—Ä–∏–π root-–¥–æ—Å—Ç—É–ø (—è–∫—â–æ —â–µ –Ω–µ –∑—Ä–æ–±–ª–µ–Ω–æ).

–í–∏–¥–∞–ª–∏—Ç–∏ root-–ø–∞—Ä–æ–ª—ñ –∞–±–æ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –ø–∞—Ä–æ–ª—å, —è–∫—â–æ –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω.

## 11. –ö–æ—Ä–æ—Ç–∫–∏–π —á–µ–∫-–ª–∏—Å—Ç ¬´–ø—ñ—Å–ª—è¬ª (—â–æ –∑—Ä–æ–±–∏—Ç–∏ –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ)

‚úî –ü–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ –º–æ–∂–Ω–∞ –∑–∞–π—Ç–∏ —è–∫ newuser.

‚úî –£–≤—ñ–º–∫–Ω—É—Ç–∏ UFW —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞.

‚úî –£–≤—ñ–º–∫–Ω—É—Ç–∏ fail2ban.

‚úî –û–Ω–æ–≤–∏—Ç–∏ —Å–∏—Å—Ç–µ–º—É.

‚úî –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ —Ä–µ–∑–µ—Ä–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –∞—Ä—Ö—ñ–≤—ñ–≤ —É –±–µ–∑–ø–µ—á–Ω–µ –º—ñ—Å—Ü–µ (–ª–æ–∫–∞–ª—å–Ω–æ/Google Drive/S3).

‚úî –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ Cloudflare (—Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è) —Ç–∞ –ø—Ä–∏—Ö–æ–≤–∞—Ç–∏ —Ä–µ–∞–ª—å–Ω–∏–π IP Droplet (–ø—Ä–æ–∫—Å—ñ).
