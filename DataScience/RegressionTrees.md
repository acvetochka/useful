# Дерева рішень

Дерева рішень можна використовувати для класифікації, але ми також можемо використовувати їх для регресії, які зазвичай називають деревами регресії. 

Основна ідея дерев регресії полягає в тому, щоб розбити наші дані на групи на основі ознак, як при класифікації, і повернути прогноз, який є середнім значенням для даних, які ми вже бачили. 

Розглянемо дані про житло нижче, де ми використовуємо "вік" для прогнозування "ціни" будинку. 
    

Тут ми бачимо, як вік впливає на ціни на житло. У віці від 0 до 10 років середня ціна становить приблизно $500 000, у віці від 10 до 50 років - приблизно $380 000, а будинки, старші за 50 років, мають середню ціну приблизно $100 000. Використовуючи ці загальні діапазони, ми можемо спрогнозувати ціну будинку. 


Використовуючи наведені вище дані, ми можемо створити дерево регресії, як показано нижче. Ціни були визначені шляхом обчислення середньої ціни будинків у віковому діапазоні. 


Як бачите, ми використовуємо ознаки для групування будинків, а потім обчислюємо середню ціну в цих групах. 


## Критерій 
Спосіб побудови дерев схожий на класифікацію, але замість критерію використовується критерій ентропії. У деревах класифікації ми вибираємо ознаки, які збільшують інформативність. У деревах регресії ми вибираємо ознаки, які мінімізують похибку. 

Популярним критерієм є середня абсолютна похибка, яку ми також розглядали раніше.

MAE=1n∑i=1n|yi−y^i|

## Як будуються дерева регресії? 
Візьмемо приклад набору даних, показаний нижче, першим кроком буде визначення першого рішення. Ми зробимо це за допомогою критерію і перевіримо кожну окрему ознаку в наборі даних, щоб побачити, яка з них дає мінімальну похибку. 


## Категоріальні ознаки 
Категоріальні ознаки прості, тут у нас є ознака Near Water, тому все, що нам потрібно зробити, це розрахувати похибку, якщо ми використаємо її як першу ознаку. Ознака "Біля води" має дві категорії: "Так" і "Ні", отже, ми повинні обчислити середню "Ціну" будинків у категоріях "Так" і "Ні". Потім ми використовуємо ці значення для обчислення середньої похибки. 

### категорія "Ні":
Індекс будинків у категорії "Ні" = [0, 1, 2, 3, 4]

Ціни будинків у категорії "Без категорії" = [260831.34, 222939.35, 101882.1, 226868.52, 94868.94] 

Середня ціна будинку в категорії "немає" = 181478,05

Абсолютна похибка = [79353.29, 41461.30, 79595.95, 45390.47, 86609.11] 

### категорія "Так":
Індекс будинків у категорії "Так" = [5,6,7,8,9]

Ціни на будинки в категорії "Так" = [197703.55, 347982.98, 343150.38, 206713.16, 329768.77] 

Середня ціна будинку в категорії "Так" = 285063.77

Абсолютна похибка = [87360.22, 62919.22, 58086.61, 78350.61, 44705.00] 

### ЗЗЗ 
Це значення MAE для об'єкта Near Water, і це число буде використано для порівняння з MAE всіх інших об'єктів, щоб визначити, який з них є найнижчим. Таким чином, воно визначить перше рішення в нашому дереві регресії. 

MAE = 66383.17   

## Числові ознаки 
З числовими ознаками, такими як "Вік", складніше працювати, оскільки нам потрібно знайти число, а не категорію, щоб розділити дані. Ми робимо це, створюючи межу між кожною точкою, а потім обчислюємо похибку. 

Наприклад, спочатку ми створюємо межу між першими двома точками даних (0, 260831.34) і (5, 347982.98), тому ми створюємо межу x = 2.5 (середина між компонентом x перших двох точок даних). Тепер ми знаходимо середню ціну будинків по ліву і праву сторону від цієї межі і використовуємо її для розрахунку MAE. 



- Ліворуч:
  Індекс цін на будинки з лівого боку = [0]

  Ціни будинків з лівого боку = [260831.34] 

  Середня ціна будинків з лівого боку = 260831.34 

  Абсолютна похибка = [0]

- Праворуч:
  
  Індекс будинків на правій стороні = [1, 2, 3, 4, 5, 6, 7, 8, 9]

  Ціни будинків правої категорії = [222939.35, 101882.1, 226868.52, 94868.94, 197703.55, 347982.98, 343150.38, 206713.16, 329768.77] 

  Середня ціна на житло в правильній категорії = 230208,64

  Абсолютна похибка = [7269.29, 128326.54, 3340.12, 135339.7, 32505.09, 117774.34, 112941.74, 23495.48, 99560.13] 

- MAE 
  Тепер ми можемо знайти MAE, використовуючи абсолютні похибки ліворуч і праворуч. 

  MAE = 66055.24 

### Подальші кроки 
Потім цей процес повторюється для кожної межі між кожною парою послідовних точок. 


В результаті отримуємо наступні значення MAE для кожної границі: 


Де значення для точок:

(2.5, 66055.24)

(7.5, 60871.09)

(15, 50847.52)

(22.5, 57918.2)

(35, 49726.55)

(50, 51792.86)

(57.5, 51288.06)

(75, 62616.49)

(95, 66568.42)

Ми бачимо, що границя 35 призводить до найнижчого значення MAE для цієї ознаки. 

## Вибір рішення 
Тепер ми порівнюємо категоріальне НЗВ та найменше числове НЗВ, в даному випадку категоріальне НЗВ дорівнює 66055.24, а числове - 49726.55. Отже, для першого рішення ми використаємо числову ознаку "Вік". В результаті ми отримаємо дерево регресії, яке виглядає наступним чином: 

 


## Коли зупинитися? 
З наведеним вище деревом регресії у нас є два варіанти: ми можемо або зупинитися на цьому і використати середнє значення "Так" (ліворуч) і "Ні" (праворуч) для прогнозування цін на житло, або продовжити додавати нові рішення в будь-яку з гілок. Існує декілька умов, які зазвичай використовуються для зупинки росту регресійних дерев: 

- Глибина дерева
- Кількість зразків, що залишилися на гілці
- Кількість зразків на кожній гілці, якщо буде прийнято ще одне рішення 

Глибина дерева, наведеного вище, дорівнює 1, тому що є єдине рішення і кількість вибірок на кожній гілці дорівнює 5. Давайте додамо більше рішень, поки глибина дерева не стане 2. Спочатку ми почнемо з гілки "Так" (ліворуч) і обчислимо MAE для ознак, що використовують будинки, які мають "Вік" < 35.

## Додавання рішень
- Ліворуч
Як і раніше, ми використовуємо ознаку "Біля води" і обчислюємо MAE для будинків з індексом 0, 3, 6, 7 і 9.

- Категоріальні ознаки
MAE = 11005.34

- Числові характеристики
Тепер ми знайдемо MAE для меж для ознаки "Вік".


Ми бачимо, що ознака "Поблизу води" спричиняє найнижче значення MAE у лівій частині дерева регресії, тому ми додамо рішення для ознаки "Поблизу води".

- Праворуч
Тепер ми знайдемо ознаки, які призводять до найнижчого значення MAE для будинків з індексами 1, 8, 2, 4 та 5.

- Категорійні ознаки
MAE = 35018.94

- Числові характеристики

Тут ми також бачимо, що ознака "Вік" призведе до найнижчого значення MAE при встановленій границі 57.5, тому в правій частині дерева ми додамо ще одне рішення для ознаки "Вік", а саме "Ні".

Остаточний результат
